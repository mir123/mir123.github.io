<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
    <title>Explicando agua virtual con infograf√≠as</title>
  <meta name="author" content="Mir Rodriguez Lombardo" />
  <base href="">
  <link rel="stylesheet" type="text/css" href="/theme/tufte-css/tufte.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="/theme/css/main.css" /> 
  <!--
  Original link to favicon
  <link rel="shortcut icon" type="text/css" href="/favicon.ico" />
  -->
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="mask-icon" href="/favicon.svg" color="black" />


  <!-- OpenGraph Info -->
  <meta property="og:title" content="Explicando agua virtual con infograf√≠as" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:title" content="Explicando agua virtual con infograf√≠as" />
  <meta property="og:image" content="http://mirrodriguezlombardo.com/images/km3.png" />
  <meta property="twitter:image" content="http://mirrodriguezlombardo.com/images/km3.png" />
  <meta property="og:url" content="sankey-graficos-mapas.html" />
  <meta property="og:description" content="Comparto algunas t√©cnicas y lecciones aprendidas para hacer infograf√≠as sobre agua. Los diagramas de Sankey son una buena manera de mostrar los flujos de cosas, en este caso de agua virtual. Para incorporarlos en una infograf√≠a, har√° falta aprender a usar el lenguaje de programaci√≥n R y tambi√©n hacer bastante dise√±o a mano." />
  <meta property="twitter:description" content="Comparto algunas t√©cnicas y lecciones aprendidas para hacer infograf√≠as sobre agua. Los diagramas de Sankey son una buena manera de mostrar los flujos de cosas, en este caso de agua virtual. Para incorporarlos en una infograf√≠a, har√° falta aprender a usar el lenguaje de programaci√≥n R y tambi√©n hacer bastante dise√±o a mano." />
  <meta property="og:locale" content="utf8" />
  <meta property="og:site_name" content="Mir Rodriguez Lombardo" />
  <meta property="article:published_time" content="2021-06-30" />
  <meta property="twitter:site:id" content="@mir_lentejas" />
  <meta property="article:section" content="Tecnolog√≠a" />

</head>

<body>

  <header>
    <h1 class="websitetitle"><a href="/">Mir Rodriguez Lombardo</a></h1>
    <nav class="navmenu" id="navmenu">
     <li><a class="navitemlink" href="/archives.html">Notas</a></li>
            <li><a class="navitemlink" href="/pages/bio.html">Hoja de vida </a></li>
            <li><a class="navitemlink" href="/pages/cartografia.html">Cartograf√≠a </a></li>
            <li><a class="navitemlink" href="/pages/web.html">Web </a></li>
            <li><a class="navitemlink" href="/pages/traduccion.html">Traducci√≥n </a></li>
            <li><a class="navitemlink" href="/pages/almanaque.html">Almanaque Azul </a></li>
            <li><a class="navitemlink" href="/pages/el-mar.html">El mar </a></li>
            <li><a class="navitemlink" href="/pages/contacto.html">Contacto </a></li>
     </nav>
   </header>



<script type="text/javascript">
function checkForm() {
name = document.getElementById("name").value;
email = document.getElementById("email").value;
comment = document.getElementById("comment").value;

if (name == "")
{
hideAllErrors();
document.getElementById("nameError").style.display = "inline";
document.getElementById("name").select();
document.getElementById("name").focus();
return false;
}
else if (email == "")
{
hideAllErrors();
document.getElementById("emailError").style.display = "inline";
document.getElementById("email").select();
document.getElementById("email").focus();
return false;
}
else if (comment == "")
{
hideAllErrors();
document.getElementById("commentError").style.display = "inline";
document.getElementById("comment").select();
document.getElementById("comment").focus();
return false;
}
if (!checkEmail(email))
{
alert('Email address is invalid');
return false;
}
return true;
}
 
function hideAllErrors() {
document.getElementById("nameError").style.display = "none";
document.getElementById("emailError").style.display = "none";
document.getElementById("commentError").style.display = "none";
}
 
function checkEmail(inputvalue) {
var pattern = /^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/;
return pattern.test(inputvalue);
}
</script>

<article>
	<section>

<header class="post-header">
<h1> <a rel="bookmark"
   title="Explicando agua virtual con infograf√≠as ¬´Mir Rodriguez Lombardo¬ª"
   href="sankey-graficos-mapas.html">
   Explicando agua virtual con infograf√≠as
</a>
 
</h1>
<p class="subtitle"><time datetime="2021-06-30T18:31:00-05:00">30 jun 2021</time><br />
<!--  -->
</span></p>




</header><p class="newsection"><i>En resumen:</i> Comparto algunas t√©cnicas y lecciones aprendidas para hacer infograf√≠as sobre agua. Los diagramas de Sankey son una buena manera de mostrar los flujos de cosas, en este caso de agua virtual. Para incorporarlos en una infograf√≠a, har√° falta aprender a usar el lenguaje de programaci√≥n R y tambi√©n hacer bastante dise√±o a mano.</p>

<p class="newsection"><span class="newthought">La Revista de la Universidad de M√©xico</span> me pidi√≥ que produjera un mapa sobre flujos de agua virtual para el <a href="https://www.revistadelauniversidad.mx/releases/52ef915f-1f21-4274-a3c2-3fe91a1d29bb/agua">n√∫mero de junio de 2020</a> sobre  <strong>agua</strong>. El concepto de <em>agua virtual</em> es s√∫per interesante y muy √∫til para educar a la gente sobre el impacto que tiene producir lo que nos comemos y los objetos industriales que nos rodean. Es decir: para producir un lim√≥n hay que regar el limonero, y si dividimos toda esa agua que le pusieron al √°rbol entre los limones que se cosechan, resulta que para producir cada lim√≥n se necesitaron casi 2 litros de agua. Ese mismo c√°lculo lo podemos hacer para muchas otras cosas, tomando en cuenta no solo el agua usada para producir algo sino el agua necesaria para disolver los desechos de la producci√≥n. En el caso del algod√≥n, se producen desechos al sembrar el algod√≥n (cuando se escurren los fertilizantes a los r√≠os) al blanquearlo y luego al te√±irlo. Seg√∫n un c√°lculo, producir una camiseta de algod√≥n requiere aproximadamente 3,900 litros de agua. La camiseta, entonces, contiene 3,900 litros de agua virtual.</p>

<p>Los flujos de ese agua virtual entre pa√≠ses que comercian con esos productos agr√≠colas o industriales es lo que se conoce como la <em>huella h√≠drica</em>, un concepto creado por el cient√≠fico holand√©s <a href="https://www.utwente.nl/en/news/2019/11/178909/in-memoriam-arjen-hoekstra">Arjen Hoekstra</a><label for="Hoekstra" class="margin-toggle">&#8853;</label><input type="checkbox" id="Hoekstra" class="margin-toggle"/><span class="marginnote">Hoekstra, que publicaba sus art√≠culos bajo una licencia Creative Commons, produjo una <a href="https://waterfootprint.org/en/resources/waterstat/product-water-footprint-statistics/">lista exhaustiva</a> de la huella h√≠drica de los productos agr√≠colas que es una referencia fundamental</span> y promovido a trav√©s de su <a href="https://waterfootprint.org/">Water Footprint Network</a>. Hoekstra muri√≥ de manera inesperada en 2019, pero su trabajo sigue siendo esencial. El concepto de agua virtual, su validez y su utilidad son sujeto de debate. Los foros internacionales y muchos de los que piensan en estos asuntos lo incorporaron a sus an√°lisis, pero algunos cuestionan las metodolog√≠as usadas y por consiguiente la validez de los datos. Tambi√©n se critica la capacidad de estas ideas para realmente producir alg√∫n cambio.</p>
<p>Pero creo que la conclusi√≥n general es v√°lida. Tambi√©n hay que mejorar la capacidad de recaudar y procesar los datos sobre gesti√≥n de agua y aprender a comunicar estos conceptos tan complejos. Acumular y ordenar esta informaci√≥n es una labor tit√°nica, que involucra reunir fuentes muy diversas, muchas de ellas enterradas en informes en PDF o en papel, en art√≠culos, entrevistas, conferencias y presentaciones de powerpoint. Otros tantos datos son aproximaciones o se tienen que extrapolar de datos antiguos. Una de las ideas de los conceptos de huella h√≠drica y de agua virtual es que las naciones y comunidades puedan manejar mejor su agua, pero el requisito es monitoreo y buenos datos.</p>
<p><label for="piscinas-marginales" class="margin-toggle">&#8853;</label><input type="checkbox" id="piscinas-marginales" class="margin-toggle"/><span class="marginnote"><img alt="Un d√≠a de operaciones del Canal de Panam√° utiliza suficiente agua para llenar m√°s o menos 1,755,274 &quot;piscinas marginales&quot;" src="/images/piscinas_marginales.jpg"> <a href="https://www.instagram.com/infidelbastro/">Jonathan Harker</a> y yo ideamos una vez una comparaci√≥n de la capacidad de las esclusas del Canal de Panam√° (o sea, el agua que gasta el Canal) con las piscinas plegables populares en los barrios. En ese entonces la elite pol√≠tica del pa√≠s, principal beneficiaria del Canal y sus negocios anexos, estaba criticando las piscinas por desperdiciar agua.</span></p>
<p class="newsection"><span class="newthought">El primer reto</span> al hacer gr√°ficos sobre este tema es intentar transmitir el √≥rden de magnitud de los datos. Estas cifras hablan de cantidades enormes de agua, muy dif√≠ciles de imaginar, expresadas en kil√≥metros c√∫bicos (km<sup>3</sup>). </p>

<p><img alt="¬øCu√°nto es 1 kil√≥metro c√∫bico de agua?" src="/images/km3_agua.png"></p>
<p>La primera infograf√≠a (el dise√±o editorial es de Krystal Mej√≠a) intenta crear una imagen mental del √≥rden de magnitud de nuestras cifras. <strong>¬øCu√°nto es 1 km<sup>3</sup> de agua?</strong> muestra un diagrama (hecho con <a href="https://inkscape.org/">Inkscape</a>) que utiliza a modo de comparaci√≥n un edificio grande e ic√≥nico de la ciudad de M√©xico, la Torre Latinoamericana, de 166 m de altura (182 m hasta la punta de la antena). Un cubo imaginario con 1 km<sup>3</sup> de agua medir√≠a 1 km de alto. Usando una simple regla de 3 dibuj√© una l√≠nea proporcional a mi diagrama de la torre y con ella el resto del cubo y lo llen√© de agua azul. Sigue siendo imposible imaginarlo, as√≠ que busqu√© algunos datos de Wikipedia y de un art√≠culo de 2011<label for="ortegaref" class="margin-toggle sidenote-number">&#8853;</label><input type="checkbox" id="ortegaref" class="margin-toggle"/><span class="sidenote">Nuria Merce Ortega Font, "El agua en n√∫meros", Casa del tiempo, UAM, marzo de 2011, Vol. IV  √©poca IV  n√∫mero 41.</span> con cifras sobre M√©xico. Igual no creo que ayud√≥ tanto, pero al menos tenemos una idea. ¬øQu√© otras comparaciones √∫tiles y did√°cticas se podr√≠an hacer? </p>
<p>El siguiente tema es la comparaci√≥n entre uso de agua sostenible y uso insostenible. El principal usuario de agua en el mundo es la agricultura (seguido de la industria y el uso dom√©stico), as√≠ que decid√≠ graficar una comparaci√≥n de la sostenibilidad de los sistemas de riego. Adem√°s, hab√≠a datos recientes<label for="lorenzoref" class="margin-toggle sidenote-number"></label><input type="checkbox" id="lorenzoref" class="margin-toggle"/><span class="sidenote">Rosa, Lorenzo, et al. "Global unsustainable virtual water flows in agricultural trade." Environmental Research Letters 14.11 (2019): 114001.</span>. Resulta que m√°s de la mitad de los sistemas de riego agr√≠cola en el mundo son insostenibles, </p>
<p><img alt="Riego insostenible" src="/images/riego_insostenible_original.png">
es decir que se extraen m√°s r√°pido de lo que se recargan las reservas de agua disponible y acaban con los flujos necesarios para los ecosistemas. Los peores en este sentido son la India, China, Pakist√°n y los Estados Unidos. El el caso de M√©xico, se estima que el 63% de los 28 km<sup>3</sup> de agua de riego agr√≠cola de M√©xico provienen de fuentes insostenibles, sin embargo apenas el 4% de los pozos se monitorea y no lo sabemos con certeza. Adem√°s, muchos pozos agr√≠colas son usados irregularmente para miner√≠a, industrias, turismo y uso dom√©stico.</p>
<p>El gr√°fico de arriba es la versi√≥n que envi√© a los editores. Quer√≠a que el grosor de las barras reflejara el total de agua de riego agr√≠cola, agregando una dimensi√≥n adicional que permitiera comprar la importancia relativa de cada regi√≥n. No hall√© manera sencilla de hacerlo. Simplemente no es posible usando una hoja de c√°lculo. As√≠ que finalmente, despu√©s de a√±os de verlo mencionado y no usarlo, tuve que meter la mano en <strong>R</strong>, un lenguaje de programaci√≥n para estad√≠sticas y gr√°ficos. Si est√°s interesadx en hacer infograf√≠as basadas en datos, tarde o temprano tendr√°s que aprender <a href="https://www.r-project.org/">R</a>. Si nunca has programado, creo que R es una buena opci√≥n para comenzar y hay innumerables tutoriales y cursos disponibles.</p>
<p>Lo primero fue reunir los datos del art√≠culo de Rosa et al, convenientemente disponibles en formato Excel, y agrupar las cifras por pa√≠s en continentes. Al final, qued√© con esta tabla, lista para importar a R en formato csv. La columna valor est√° en porcentajes, el ancho es el volumen total de riego:</p>
<p><br/></p>
<table>
<thead>
<tr>
<th>region</th>
<th>variable</th>
<th>valor</th>
<th>ancho</th>
</tr>
</thead>
<tbody>
<tr>
<td>Asia del Sur</td>
<td>insostenible</td>
<td>0.534190397198415</td>
<td>434.04</td>
</tr>
<tr>
<td>Asia del Sur</td>
<td>sostenible</td>
<td>0.465809602801585</td>
<td>434.04</td>
</tr>
<tr>
<td>Asia del Este y Pac√≠fico</td>
<td>insostenible</td>
<td>0.539271075661903</td>
<td>180.54</td>
</tr>
<tr>
<td>Asia del Este y Pac√≠fico</td>
<td>sostenible</td>
<td>0.460728924338097</td>
<td>180.54</td>
</tr>
<tr>
<td>Norteam√©rica</td>
<td>insostenible</td>
<td>0.619229699666296</td>
<td>143.84</td>
</tr>
<tr>
<td>Norteam√©rica</td>
<td>sostenible</td>
<td>0.380770300333704</td>
<td>143.84</td>
</tr>
<tr>
<td>Medio Oriente y √Åfrica del Norte</td>
<td>insostenible</td>
<td>0.559066666666667</td>
<td>150</td>
</tr>
<tr>
<td>Medio Oriente y √Åfrica del Norte</td>
<td>sostenible</td>
<td>0.440933333333333</td>
<td>150</td>
</tr>
<tr>
<td>Europa y Asia Central</td>
<td>insostenible</td>
<td>0.390086900547152</td>
<td>124.28</td>
</tr>
<tr>
<td>Europa y Asia Central</td>
<td>sostenible</td>
<td>0.609913099452848</td>
<td>124.28</td>
</tr>
<tr>
<td>√Åfrica Subsahariana</td>
<td>insostenible</td>
<td>0.430569105691057</td>
<td>30.75</td>
</tr>
<tr>
<td>√Åfrica Subsahariana</td>
<td>sostenible</td>
<td>0.569430894308943</td>
<td>30.75</td>
</tr>
<tr>
<td>Latinoam√©rica y el Caribe</td>
<td>insostenible</td>
<td>0.178110944527736</td>
<td>33.35</td>
</tr>
<tr>
<td>Latinoam√©rica y el Caribe</td>
<td>sostenible</td>
<td>0.821889055472264</td>
<td>33.35</td>
</tr>
<tr>
<td>Escala</td>
<td>insostenible</td>
<td>0.5</td>
<td>100</td>
</tr>
<tr>
<td>Escala</td>
<td>sostenible</td>
<td>0.5</td>
<td>100</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>El c√≥digo R para hacer el gr√°fico es s√∫per corto:
<br/></p>
<div class="highlight"><pre><span></span><span class="c1"># Dibuja un gr√°fico de barras horizontales con el grosor determinado por una variable</span>

<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>

<span class="n">irr</span><span class="o">&lt;-</span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;riego_sost_insost.csv&quot;</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">irr</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">region</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">valor</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">variable</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">ancho</span><span class="o">/</span><span class="m">400</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">))</span> <span class="o">+</span>  <span class="nf">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">)</span>
</pre></div>


<p>y produce esto,</p>
<p><img alt="Riego insostenible de R" src="/images/Rplot01.png">
lo exportas a PDF y lo abres en Inkscape para arreglarlo. El dise√±o final de Krystal Mej√≠a con las correcciones de los editores qued√≥ as√≠:</p>
<p><img alt="Riego insostenible" src="/images/infografia_agua_final_3.jpg"></p>
<p class="newsection"><span class="newthought">Los flujos comerciales de agua virtual</span> nos pueden dar una m√©trica de la sostenibilidad de las econom√≠as de los pa√≠ses y las regiones. Hoekstra y Mekonen publicaron en 2011 un mapa cl√°sico que muestra que los principales exportadores (brutos) de agua virtual est√°n en Norteam√©rica. El grosor de la flecha indica la cantidad. La flecha gorda de Estados Unidos a M√©xico refleja las importaciones masivas de productos a M√©xico luego de la firma del tradado de libre comercio de Am√©rica del Norte. El color indica el balance nacional neto de agua virtual, los pa√≠ses en verde son exportadores netos y los pa√≠ses en rojo, importadores de agua virtual. Hay muchos detalles que no aparecen aqu√≠, por ejemplo si los flujos son de agua azul (riego) o verde (lluvia y agua subterr√°nea).</p>

<p><label for="mapahoekstra" class="margin-toggle ">&#8853;</label><input type="checkbox" id="mapahoekstra" class="margin-toggle"/><span class="marginnote"><img alt="Mapa global del balance de agua virtual y flujos entre pa√≠ses" src="/images/Hoekstra-flujo-global-agua-virtual.jpg"> Balance de agua virtual por pa√≠s y direcci√≥n de los flujos brutos de agua virtual relacionados con productos agr√≠colas e industriales en el periodo 1996‚Äì2005. Tomado de Hoekstra y Mekonnen, "The water footprint of humanity." Proceedings of the national academy of sciences 109.9 (2012): 3232-3237.</span></p>
<p>Los datos del estudio de Hoekstra son de hace m√°s de 15 a√±os, pero no conozco de otro trabajo m√°s reciente con niveles comparables de alcance y detalle. As√≠ que me tuve que conformar con los datos del trabajo de Rosa et al. de 2019, con las cifras de comercio de agua agr√≠cola insostenible entre pa√≠ses. ¬øPodr√≠amos intentar hacer un mapa comparable y aspirar a una mayor densidad de datos?</p>
<p><label for="sankey-euskadi" class="margin-toggle">&#8853;</label><input type="checkbox" id="sankey-euskadi" class="margin-toggle"/><span class="marginnote"><img alt="Diagramas de sankey sobre flujos de materiales en el Pa√≠s Vasco y en la Uni√≥n Europea" src="/images/pais_vasco_economia_circular_sankey.jpg"> Estos diagramas de Sankey comparan el flujo de materiales en el Pa√≠s Vasco y en la Uni√≥n Europea, en un <a href="https://www.euskadi.eus/contenidos/informacion/economia_circular/es_def/adjuntos/Indicadores_economia_circular_pais_vasco_2018.pdf">informe sobre indicadores de econom√≠a circular</a>. Se puede ver la diferencia en importaciones y exportaciones, por ejemplo, y cu√°nto del flujo de materiales (minerales, combustible, biomasa) es circular.</span>El mapa de Hoekstra es un ejemplo de <a href="https://es.wikipedia.org/wiki/Diagrama_de_Sankey">diagrama de Sankey</a>, un tipo de gr√°fico apto para reflejar flujos. El grosor de una l√≠nea determina la magnitud del flujo entre nodos, que pueden ser energ√≠a entre secciones de una m√°quina, dinero entre participantes de un mercado o agua virtual entre pa√≠ses. Para hacer estos diagramas, una vez m√°s echamos mano de R.</p>
<p>El paquete de R <a href="https://logfc.wordpress.com/2014/02/27/riverplot/">riverplot</a> permite hacer diagramas de Sankey que incorporan las coordenadas de los nodos. El autor de ese paquete lo us√≥ para replicar el famoso gr√°fico de Minard, <a href="https://www.edwardtufte.com/tufte/minard">citado por Edward Tufte</a> como la mejor infograf√≠a jam√°s dibujada. Usando  R y <strong>riverplot</strong> intent√© mapear los flujos entre todos los pa√≠ses: </p>
<p><img alt="Mapa Sankey de flujos de agua virtual entre pa√≠ses" src="/images/rplot_mapa_1.jpg">
Imagina el mapamundi de fondo. Un poquito api√±ado. Luego trat√© de resumirlo a regiones:</p>
<p><img alt="Mapa Sankey de flujos de agua virtual entre regiones" src="/images/rplot_mapa_2.jpg"></p>
<p>Y finalmente hice solo las exportaciones de M√©xico:</p>
<p><img alt="Mapa Sankey de flujos de agua virtual entre pa√≠ses" src="/images/rplot_mapa_3.jpg"></p>
<p>Est√° bien feo y no cuenta bien ninguna historia. A pesar de que me tom√≥ 4 d√≠as llegar a ese punto (estas cosas toman tiempo, ¬°recuerda siempre cobrar bien!) decid√≠ tirarlo a la basura. Baj√© un poco las expectativas y me puse a hacer uno m√°s sencillo. </p>
<p>Con ese fin us√© el paquete <a href="http://christophergandrud.github.io/networkD3/">networkD3</a> de R, que incorpora la fant√°stica biblioteca Javascript <a href="https://d3js.org/">D3</a> para hacer diagramas de red, incluyendo Sankey. La ventaja del networkD3 es que el producto final es un archivo HTML que incluye el c√≥digo SVG del diagrama, es decir que recortando esa secci√≥n del HTML podemos producir un archivo para abrir y modificar en Inkscape y pasarlo a la dise√±adora editorial. </p>
<p><img alt="Diagrama Sankey sobre el comercio global de agua virtual de riego insostenible" src="/images/infografia_agua_final_4.jpg"></p>
<p>Para llegar a ese punto pas√© por varias versiones intentando poner cada regi√≥n una sola vez, en lugar de a cada lado del diagrama:</p>
<p><img alt="Versi√≥n anterior del diagrama Sankey sobre el comercio global de agua virtual de riego insostenible" src="/images/sankey_agua_circular.jpg">
que no funciona muy bien, aunque es visualmente interesante ver los flujos dentro de cada regi√≥n.</p>
<p><a href="#" class="showModal" ><label for="sankeyinteractivo" class="margin-toggle ">&#8853;</label><input type="checkbox" id="sankeyinteractivo" class="margin-toggle"/><span class="marginnote"><img alt="Enlace a diagrama Sankey interactivo" src="/images/sankey_agua_thumbnail.jpg"> Haz clic aqu√≠ para ver el diagrama Sankey interactivo producido por D3.</span></a></p>
<p>La biblioteca D3 est√° dise√±ada para producir gr√°ficos interactivos en la web, lo cual es un producto totalmente diferente que un diagrama para una revista impresa. <a href="#" class="showModal" >Haz clic aqu√≠</a> para ver una versi√≥n interactiva. En este gr√°fico puedes visualizar con un color cada regi√≥n por separado al mover el puntero encima del nodo y las cantidades aparecen al poner el puntero sobre las coneziones. Tambi√©n puedes cambiar el √≥rden de los nodos. </p>
<p>A continuaci√≥n el c√≥digo R que produce este diagrama. Los datos est√°n en dos archivos csv, <a href="/adjuntos/regiones_d3.csv">uno con la lista de regiones</a>
 y otro con <a href="/adjuntos/exportacion_importacion_d3.csv">los flujos entre cada regi√≥n</a> (recuerda citar la fuente, Rosa, Lorenzo, et al. (2019) si usas estos datos):</p>
<div class="highlight"><pre><span></span><span class="c1"># Dibuja un diagrama de Sankey de los movimientos de agua entre regiones del mundo</span>
<span class="c1"># Con datos de Hoekstra et al.</span>

<span class="nf">library</span><span class="p">(</span><span class="n">networkD3</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">htmlwidgets</span><span class="p">)</span>

<span class="n">regiones</span><span class="o">&lt;-</span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;/home/mir/Dropbox/proyectos/revista_u/agua/regiones_d3.csv&quot;</span><span class="p">,</span>
                    <span class="n">col_types</span> <span class="o">=</span> <span class="nf">cols</span><span class="p">(</span>
                    <span class="n">ID</span> <span class="o">=</span> <span class="nf">col_skip</span><span class="p">(),</span>
                    <span class="n">region</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
                    <span class="n">grupo</span> <span class="o">=</span> <span class="nf">col_character</span><span class="p">(),</span>
                    <span class="n">total</span><span class="o">=</span><span class="nf">col_character</span><span class="p">()</span>
                    <span class="p">)</span>
<span class="p">)</span>

<span class="nf">class</span><span class="p">(</span><span class="n">regiones</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;data.frame&quot;</span>

<span class="n">bordes</span><span class="o">&lt;-</span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;/home/mir/Dropbox/proyectos/revista_u/agua/exportacion_importacion_d3.csv&quot;</span><span class="p">,</span>  
                    <span class="n">col_types</span> <span class="o">=</span> <span class="nf">cols</span><span class="p">(</span>
                    <span class="n">ID1</span><span class="o">=</span><span class="nf">col_integer</span><span class="p">(),</span> 
                    <span class="n">ID2</span><span class="o">=</span><span class="nf">col_integer</span><span class="p">(),</span> 
                    <span class="n">volumen</span><span class="o">=</span><span class="nf">col_double</span><span class="p">(),</span>
                    <span class="n">color</span><span class="o">=</span><span class="nf">col_character</span><span class="p">()</span>
                 <span class="p">)</span>
<span class="p">)</span>
<span class="nf">class</span><span class="p">(</span><span class="n">bordes</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;data.frame&quot;</span>
<span class="nf">names</span><span class="p">(</span><span class="n">regiones</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;grupo&quot;</span><span class="p">,</span><span class="s">&quot;total&quot;</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">bordes</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span> <span class="s">&quot;source&quot;</span><span class="p">,</span> <span class="s">&quot;target&quot;</span><span class="p">,</span> <span class="s">&quot;volumen&quot;</span><span class="p">,</span><span class="s">&quot;color&quot;</span><span class="p">)</span>
<span class="nf">class</span><span class="p">(</span><span class="n">bordes</span><span class="p">)</span><span class="o">&lt;-</span><span class="s">&quot;data.frame&quot;</span>

<span class="n">red</span> <span class="o">&lt;-</span> <span class="nf">sankeyNetwork</span><span class="p">(</span>
      <span class="n">Links</span> <span class="o">=</span> <span class="n">bordes</span><span class="p">,</span> 
      <span class="n">Nodes</span> <span class="o">=</span> <span class="n">regiones</span><span class="p">,</span> 
      <span class="n">Source</span> <span class="o">=</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> 
      <span class="n">Target</span> <span class="o">=</span> <span class="s">&#39;target&#39;</span><span class="p">,</span> 
      <span class="n">Value</span> <span class="o">=</span> <span class="s">&#39;volumen&#39;</span><span class="p">,</span> 
      <span class="n">NodeID</span> <span class="o">=</span> <span class="s">&#39;name&#39;</span><span class="p">,</span>
      <span class="n">NodeGroup</span> <span class="o">=</span> <span class="s">&#39;grupo&#39;</span><span class="p">,</span>
      <span class="n">nodeWidth</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span>
      <span class="n">nodePadding</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span>
      <span class="n">LinkGroup</span> <span class="o">=</span> <span class="s">&#39;color&#39;</span><span class="p">,</span>
      <span class="n">sinksRight</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
      <span class="n">units</span> <span class="o">=</span> <span class="s">&quot;km3&quot;</span><span class="p">,</span>
      <span class="n">fontSize</span> <span class="o">=</span> <span class="s">&quot;10&quot;</span><span class="p">,</span>
      <span class="n">fontFamily</span> <span class="o">=</span> <span class="s">&quot;sans&quot;</span><span class="p">,</span>
      <span class="n">width</span> <span class="o">=</span> <span class="s">&quot;100vw&quot;</span><span class="p">,</span>
      <span class="n">height</span> <span class="o">=</span> <span class="s">&quot;100vh&quot;</span><span class="p">,</span>
      <span class="n">iterations</span> <span class="o">=</span> <span class="m">100</span><span class="p">)</span>

<span class="nf">saveWidget</span><span class="p">(</span><span class="n">widget</span> <span class="o">=</span> <span class="n">red</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s">&quot;sankey_agua.html&quot;</span><span class="p">,</span> 
           <span class="n">selfcontained</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p class="newsection"><span class="newthought">La huella h√≠drica</span> de los productos agr√≠colas e industriales nos da una medida r√°pida del agua necesaria para producirlos. Esto incluye el agua de riego, la de los procesos industriales y la necesaria para diluir los desechos de los procesos. Una vez m√°s, us√© datos de Hoekstra<label for="hoekstraref2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="hoekstraref2" class="margin-toggle"/><span class="sidenote">Mekonnen, M.M. & Hoekstra, A.Y. (2011) The green, blue and grey water footprint of crops and derived crop products, Hydrology and Earth System Sciences, 15(5): 1577-1600.</span>, pero tambi√©n de Amigos de la Tierra<label for="foeref" class="margin-toggle sidenote-number"></label><input type="checkbox" id="fueref" class="margin-toggle"/><span class="sidenote">Burley, Helen. "Mind your step: Land and water footprint of every day products" Friends of the earth (2015).</span> y un art√≠culo<label for="wuref" class="margin-toggle sidenote-number"></label><input type="checkbox" id="wuref" class="margin-toggle"/><span class="sidenote">Wu, May, and Hui Xu. Consumptive water use in the production of ethanol and petroleum gasoline‚Äî2018 update. No. ANL/ESD/09-1 Rev. 2. Argonne National Lab.(ANL), Argonne, IL (Estados Unidos), 2018.</span> sobre el uso de agua para la producci√≥n de gasolina.</p>

<p><img alt="Riego insostenible" src="/images/infografia_agua_final_1.jpg"></p>
<p>Esta infograf√≠a es una adaptaci√≥n del <a href="http://virtualwater.eu/">dise√±o original</a> del alem√°n <a href="http://www.kekeritz.com/">Timm Kekeritz</a> y se puede ver de una forma u otra en <a href="http://thewaterweeat.com/">otros</a> <a href="https://www.mo.be/zeronaut/hoe-watervoetafdruk-verkleinen">lugares</a>. Se podr√≠a decir que es demasiado gen√©rico, pero creo que hay que darle cr√©dito a Kekeritz. Una vez elegidos los productos e investigado las cifras, lo produje 100% a mano con Inkscape, usando el caracter Unicode de gota de agua (üíß) y repiti√©ndolo cuantas veces fuera necesario. ¬øExiste alguna herramienta que ayude con esto?</p>
<p>Y eso es todo. Puedes ver las infograf√≠as en el sitio web de la <a href="https://www.revistadelauniversidad.mx/articles/e27fd1ff-9d55-42cf-8417-89189f78bff1/huella-hidrica-y-agua-virtual">Revista de la Universidad de M√©xico</a>.</p>
<p class="newsection"><span class="newthought">Hay una lecci√≥n muy importante</span> que aprend√≠ de esta chamba. Si quieres que tu mapa o diagrama Sankey sea visualmente atractivo, no existe software (todav√≠a) que lo haga autom√°ticamente. Siempre ser√° necesario dise√±arlo a mano. Quiz√° hubiera sido posible hacer el mapa de flujos de agua de riego, pero hubiera tomado mucho m√°s tiempo que el necesario para entregar la infograf√≠a a tiempo. Vale la pena, los mapas y diagramas de Sankey con flechas o barras de grosor variable son una excelente herramienta de comunicaciones y para la educaci√≥n.</p>

<h2>Comentarios</h2>
<p><em><p class="newsection">Los comentarios son moderados antes de publicarse.</p></em></p>
<script language="JavaScript">
var username = "mir.rodriguez";
var hostname = "guineo.org";
var linktext = username + "@" + hostname ;
document.write("<form onsubmit='return checkForm();' action='http://formspree.io/" + username + "@" + hostname + "' method='POST'>");
</script>

<div class="nombre">
<input type="text" id="name" name="name" placeholder="NOMBRE" aria-label="Nombre"><br/>
<div class="error" id="nameError">Debes poner tu nombre<br /></div>
</div>

<div class="contact_email">
<input type="email" id="email" name="_replyto" placeholder="EMAIL" aria-label="Email"><br/>
<div class="error" id="emailError">Necesito tu direcci√≥n de email<br /></div>
</div>

<div class="contact_comment">
<textarea name="body" id="comment" placeholder="COMENTARIO" aria-label="Mensaje" rows="5"></textarea><br/>
<div class="error" id="commentError">Por favor escribe un comentario<br /></div>
<input type="hidden" name="_format" value="plain" />
<input type="hidden" name="_language" value="es" />
</div>

<p><button type="submit" style="margin-left: -1.5em;" value="ENVIAR">SIGUIENTE</button>
</form> </p>
<p class="newsection">Tambi√©n puedes <a href="https://twitter.com/mir_lentejas/status/1153386856962240512">comentar v√≠a Twitter</a></p>

<div id="modal" class="modal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button class="btn btn-default" type="button" onclick="modal.close();">&#10006;</button>
</div>

<div class="modal-body">

<iframe id="sankey_agua" src="" title="W3Schools Free Online Web Tutorials"></iframe> 

</div>


</div>
</div>
</div>

<style>
.modal {
display: none;
background: rgba(0, 0, 0, .30);
z-index: 999;
padding: 30px 0;

position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;

overflow-x: hidden;
overflow-y: auto;
}

.modal .modal-dialog {
position: relative;
width: 90%;
border-radius: 6px;
-webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, .5);
box-shadow: 0 3px 9px rgba(0, 0, 0, .5);
height: 100%;
margin: 0 auto;
background-color: #fffff8;
}

.modal-content {
position: relative;
width: 100%;
height: 100%;
pointer-events: auto;
outline: 0;
display: flex;
flex-direction: column;
}

.modal-header {

align-items: center;
justify-content: space-between;
padding: 3px;
border-top-left-radius: calc(.3rem - 1px);
border-top-right-radius: calc(.3rem - 1px);
}

.modal-body {
position: relative;
margin: 10px;
height:100%;
}

iframe {
width:100%;
height:100%;
border:none;
}

button {
  border:none;
  cursor:pointer;
}

</style>

<script>
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.RModal = factory());
}(this, (function () {
var splitClasses = function (classes) { return (("" + (classes || ''))
.split(' ')
.filter(function (cls) { return !!cls; })); };
var addClass = function (el, classes) {
splitClasses(classes).forEach(function (cls) {
el.classList.add(cls);
});
};
var removeClass = function (el, classes) {
splitClasses(classes).forEach(function (cls) {
el.classList.remove(cls);
});
};
var RModal = /** @class */ (function () {
function RModal(el, opts) {
var _this = this;
if (opts === void 0) { opts = {}; }
this.version = '1.1.0';
this.focusOutElement = null;
this.opened = false;
this.opts = {
bodyClass: 'modal-open',
dialogClass: 'modal-dialog',
dialogOpenClass: 'bounceInDown',
dialogCloseClass: 'bounceOutUp',
focus: true,
focusElements: [
'a[href]', 'area[href]', 'input:not([disabled]):not([type=hidden])',
'button:not([disabled])', 'select:not([disabled])',
'textarea:not([disabled])', 'iframe', 'object', 'embed',
'*[tabindex]', '*[contenteditable]'
],
escapeClose: true,
content: undefined,
closeTimeout: 500
};
Object.keys(opts).forEach(function (key) {
var optionsKey = key;
/* istanbul ignore else */
if (opts[optionsKey] !== undefined) {
_this.opts[optionsKey] = opts[optionsKey];
}
});
this.overlay = el;
this.dialog = el.querySelector("." + this.opts.dialogClass);
if (this.opts.content) {
this.content(this.opts.content);
}
}
RModal.prototype.open = function (content) {
var _this = this;
this.content(content);
if (typeof this.opts.beforeOpen !== 'function') {
return this._doOpen();
}
this.opts.beforeOpen(function () {
_this._doOpen();
});
};
RModal.prototype._doOpen = function () {
addClass(document.body, this.opts.bodyClass);
removeClass(this.dialog, this.opts.dialogCloseClass);
addClass(this.dialog, this.opts.dialogOpenClass);
this.overlay.style.display = 'block';
if (this.opts.focus) {
this.focusOutElement = document.activeElement;
this.focus();
}
if (typeof this.opts.afterOpen === 'function') {
this.opts.afterOpen();
}
this.opened = true;
};
RModal.prototype.close = function () {
var _this = this;
if (typeof this.opts.beforeClose !== 'function') {
return this._doClose();
}
this.opts.beforeClose(function () {
_this._doClose();
});
};
RModal.prototype._doClose = function () {
var _this = this;
removeClass(this.dialog, this.opts.dialogOpenClass);
addClass(this.dialog, this.opts.dialogCloseClass);
removeClass(document.body, this.opts.bodyClass);
if (this.opts.focus) {
this.focus(this.focusOutElement);
}
setTimeout(function () {
_this.overlay.style.display = 'none';
if (typeof _this.opts.afterClose === 'function') {
_this.opts.afterClose();
}
_this.opened = false;
}, this.opts.closeTimeout);
};
RModal.prototype.content = function (html) {
if (html === undefined) {
return this.dialog.innerHTML;
}
this.dialog.innerHTML = html;
};
RModal.prototype.elements = function (selector, fallback) {
fallback = fallback || window.navigator.appVersion.indexOf('MSIE 9.0') > -1;
selector = Array.isArray(selector) ? selector.join(',') : selector;
return [].filter.call(this.dialog.querySelectorAll(selector), function (element) {
if (fallback) {
var style = window.getComputedStyle(element);
return style.display !== 'none' && style.visibility !== 'hidden';
}
return element.offsetParent !== null;
});
};
RModal.prototype.focus = function (el) {
el = el || this.elements(this.opts.focusElements || '')[0] || this.dialog.firstChild;
if (el && typeof el.focus === 'function') {
el.focus();
}
};
RModal.prototype.keydown = function (ev) {
if (this.opts.escapeClose && ev.which == 27) {
this.close();
}
var stopEvent = function () {
ev.preventDefault();
ev.stopPropagation();
};
if (this.opened && ev.which == 9 && this.dialog.contains(ev.target)) {
var elements = this.elements(this.opts.focusElements || ''), first = elements[0], last = elements[elements.length - 1];
if (first == last) {
stopEvent();
}
else if (ev.target == first && ev.shiftKey) {
stopEvent();
last.focus();
}
else if (ev.target == last && !ev.shiftKey) {
stopEvent();
first.focus();
}
}
};
RModal.version = '1.1.0';
return RModal;
}());

return RModal;

})));
//# sourceMappingURL=rmodal.js.map

window.onload = function() {
var modal = new RModal(document.getElementById('modal'), {
//content: 'Abracadabra'
beforeOpen: function(next) {
// document.body.addEventListener("click", function(){ modal.close(); }); 
next();
},
afterOpen: function() {
},
beforeClose: function(next) {
next();
},
afterClose: function() {
//document.body.removeEventListener("click", function(){ modal.close(); });
},
  // dialogOpenClass: 'animate__slideInDown',
  // dialogCloseClass: 'animate__slideOutUp'
  // // bodyClass: 'modal-open',
  // // dialogClass: 'modal-dialog',

  // // focus: true,
  // // focusElements: ['input.form-control', 'textarea', 'button.btn-primary'],

  // // escapeClose: true
});

document.addEventListener('keydown', function(ev) {
modal.keydown(ev);
}, false);

const elements = document.querySelectorAll('.showModal');

elements.forEach(el => el.addEventListener('click', function(event) {
event.preventDefault();
document.getElementById('sankey_agua').src="sankey_agua_hovers.html";
modal.open();
window.modal = modal;
}));


}

</script>
	<section>
</article>
<footer>
   <header>


  <nav class="navmenu" id="navmenu">

          <li><a class="navitemlink" href="/archives.html">Notas</a></li>
          <li><a class="navitemlink" href="/pages/bio.html">Hoja de vida</a></li>
          <li><a class="navitemlink" href="/pages/cartografia.html">Cartograf√≠a</a></li>
          <li><a class="navitemlink" href="/pages/web.html">Web</a></li>
          <li><a class="navitemlink" href="/pages/traduccion.html">Traducci√≥n</a></li>
          <li><a class="navitemlink" href="/pages/almanaque.html">Almanaque Azul</a></li>
          <li><a class="navitemlink" href="/pages/el-mar.html">El mar</a></li>
          <li><a class="navitemlink" href="/pages/contacto.html">Contacto</a></li>
   </nav>
 </header>
  <!-- <p>Powered by <a href="http://pelican.readthedocs.org">Pelican</a></p> --> 
</footer>
</body>
</html>